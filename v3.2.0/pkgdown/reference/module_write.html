<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate a BioCro module header file. — module_write • BioCro</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a BioCro module header file. — module_write"><meta name="description" content="To facilitate the creation of new BioCro modules, module_write
  generates a BioCro module header file. Given a set of input and output
  variables, module_write will create a C++ header file ('.h' file) by
  filling in a template with the input and output variables, ensuring the
  correct C++ syntax for a BioCro module."><meta property="og:description" content="To facilitate the creation of new BioCro modules, module_write
  generates a BioCro module header file. Given a set of input and output
  variables, module_write will create a C++ header file ('.h' file) by
  filling in a template with the input and output variables, ensuring the
  correct C++ syntax for a BioCro module."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BioCro</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../about_pkgdown_documentation.html">About</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>GENERAL BIOCRO USAGE</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/BioCro.html">Getting Started with BioCro (HTML)</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/a_practical_guide_to_biocro.pdf">A Practical Guide to BioCro (PDF)</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/a_practical_guide_to_biocro.R">    [R code]</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/quantitative_model_comparison.pdf">Quantitative Comparison Between Two Photosynthesis Models (PDF)</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/quantitative_model_comparison.R">    [R code]</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/BioCro-II_Paper--Section-1.1-example.html">BioCro II Paper: Section 1.1 Example (HTML)</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/dynamical_systems.pdf">BioCro as a Dynamical System</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/an_introduction_to_biocro.pdf">An Introduction to BioCro for Those Who Want to Add Models (PDF)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>CROP GROWTH MODELING TOPICS</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/web_only/avoiding_pitfalls_fvcb.html">Avoiding Pitfalls When Using the FvCB Model (HTML)</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/thick_layer_absorption.html">Light Absorption by a Thick Layer (HTML)</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/ball_berry_model.html">Using the Ball-Berry Model (HTML)</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/canopy_photosynthesis.html">Multi-layer Canopy Photosynthesis Models (HTML)</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/energy_balance.html">Energy Balance, Leaf Temperature, and Transpiration (HTML)</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../../bookdown/index.html">Developer's Manual</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-c-library" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">C++ Library</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-c-library"><li><a class="dropdown-item" href="../../doxygen/doxygen_docs_complete/index.html">Complete Doxygen Documentation</a></li>
    <li><a class="dropdown-item" href="../../doxygen/doxygen_docs_framework/index.html">Framework Documentation</a></li>
    <li><a class="dropdown-item" href="../../doxygen/doxygen_docs_modules/index.html">BioCro Module Documentation</a></li>
    <li><a class="dropdown-item" href="../../doxygen/doxygen_docs_modules_public_members_only/index.html">BioCro Module Documentation (public members only)</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/biocro/biocro/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate a BioCro module header file.</h1>

      <div class="d-none name"><code>module_write.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>To facilitate the creation of new BioCro modules, <code>module_write</code>
  generates a BioCro module header file. Given a set of input and output
  variables, <code>module_write</code> will create a C++ header file ('.h' file) by
  filling in a template with the input and output variables, ensuring the
  correct C++ syntax for a BioCro module.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">module_write</span><span class="op">(</span></span>
<span>    <span class="va">module_name</span>,</span>
<span>    <span class="va">module_library</span>,</span>
<span>    <span class="va">module_type</span>,</span>
<span>    <span class="va">inputs</span>,</span>
<span>    <span class="va">outputs</span>,</span>
<span>    output_equations <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    input_units <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    output_units <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-module-name">module_name<a class="anchor" aria-label="anchor" href="#arg-module-name"></a></dt>
<dd><p>A string for the module's name.</p></dd>


  <dt id="arg-module-library">module_library<a class="anchor" aria-label="anchor" href="#arg-module-library"></a></dt>
<dd><p>A string for the module's library namespace. E.g., <code>'biocro'</code>.</p></dd>


  <dt id="arg-module-type">module_type<a class="anchor" aria-label="anchor" href="#arg-module-type"></a></dt>
<dd><p>A string setting the module type: <code>'direct'</code> or <code>'differential'</code>.</p></dd>


  <dt id="arg-inputs">inputs<a class="anchor" aria-label="anchor" href="#arg-inputs"></a></dt>
<dd><p>A character vector of the module's input variables.</p></dd>


  <dt id="arg-outputs">outputs<a class="anchor" aria-label="anchor" href="#arg-outputs"></a></dt>
<dd><p>A character vector of the module's output variables.</p></dd>


  <dt id="arg-output-equations">output_equations<a class="anchor" aria-label="anchor" href="#arg-output-equations"></a></dt>
<dd><p>A character vector. The module's output variables will be updated with these
    variables. If <code>NULL</code>, a zero is inserted instead.</p></dd>


  <dt id="arg-input-units">input_units<a class="anchor" aria-label="anchor" href="#arg-input-units"></a></dt>
<dd><p>A character vector of the inputs' units. If <code>NULL</code>, no units are
    embedded.</p></dd>


  <dt id="arg-output-units">output_units<a class="anchor" aria-label="anchor" href="#arg-output-units"></a></dt>
<dd><p>A character vector of the outputs' units. If <code>NULL</code>, no units are
    embedded.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>type</code> should be either <code>'direct'</code> or <code>'differential'</code>;
    however, <code>module_write</code> does not enforce this in case new module types
    are created in the future.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A string containing a new BioCro module header file.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>This function returns a string and has no file I/O. Use
    <code><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></code> to print the output to console, or to save the
    output. See examples below. Note that it is customary to name the header
    file with the same name as the module.</p>
<p><code>module_write</code> checks for duplicate input or output variables, and if
    detected, it will raise an error. In theory, this check should ensure that
    the generated module will compile correctly. However, it is still possible
    to define an module that is circular and will not pass the checks in
    <code><a href="dynamical_system.html">validate_dynamical_system_inputs</a></code>. See <code>Example 4</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example 1</span></span></span>
<span class="r-in"><span><span class="co"># Inputs as character vector</span></span></span>
<span class="r-in"><span><span class="va">xs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x1'</span>,<span class="st">'x2'</span>,<span class="st">'x3'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Units</span></span></span>
<span class="r-in"><span><span class="va">xs_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Mg / ha'</span>, <span class="st">'Mg / ha / hr'</span>, <span class="st">'dimensionless'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Outputs</span></span></span>
<span class="r-in"><span><span class="va">ys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'y1'</span>,<span class="st">'y2'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">module_write</span><span class="op">(</span><span class="st">'testmod'</span>, <span class="st">'testlib'</span>, <span class="st">'direct'</span>,</span></span>
<span class="r-in"><span>    inputs<span class="op">=</span><span class="va">xs</span>, input_units<span class="op">=</span> <span class="va">xs_units</span>, outputs<span class="op">=</span><span class="va">ys</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use writeLines to print to console</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #ifndef TESTLIB_TESTMOD_H</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #define TESTLIB_TESTMOD_H</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #include "../framework/module.h"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #include "../framework/state_map.h"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> namespace testlib</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> /**</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  * @class testmod</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  * @brief Put documentation here.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  */</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class testmod : public direct_module</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    public:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     testmod(</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         state_map const&amp; input_quantities,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         state_map* output_quantities)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         : direct_module{},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           // Get references to input quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           x1{get_input(input_quantities, "x1")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           x2{get_input(input_quantities, "x2")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           x3{get_input(input_quantities, "x3")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           // Get pointers to output quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           y1_op{get_op(output_quantities, "y1")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           y2_op{get_op(output_quantities, "y2")}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     static string_vector get_inputs();</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     static string_vector get_outputs();</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     static std::string get_name() { return "testmod"; }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    private:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // References to input quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; x1;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; x2;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; x3;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Pointers to output quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double* y1_op;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double* y2_op;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Main operation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     void do_operation() const;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> };</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> string_vector testmod::get_inputs()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "x1",          // Mg / ha</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "x2",          // Mg / ha / hr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "x3"           // dimensionless</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     };</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> string_vector testmod::get_outputs()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "y1",          // Put y1 units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "y2"           // Put y2 units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     };</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> void testmod::do_operation() const</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Make calculations here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Use `update` to set outputs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     update(y1_op, 0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     update(y2_op, 0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }  // namespace testlib</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #endif</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="co"># Use writeLines to save as a `.h` file</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"./testmod.h"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2: A differential module</span></span></span>
<span class="r-in"><span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'var_1'</span>,<span class="st">'var_2'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">module_write</span><span class="op">(</span><span class="st">'testmod'</span>, <span class="st">'testlib'</span>, <span class="st">'differential'</span>, <span class="va">xs</span>, <span class="va">xs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #ifndef TESTLIB_TESTMOD_H</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #define TESTLIB_TESTMOD_H</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #include "../framework/module.h"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #include "../framework/state_map.h"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> namespace testlib</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> /**</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  * @class testmod</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  * @brief Put documentation here.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  */</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class testmod : public differential_module</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    public:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     testmod(</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         state_map const&amp; input_quantities,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         state_map* output_quantities)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         : differential_module{},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           // Get references to input quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           var_1{get_input(input_quantities, "var_1")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           var_2{get_input(input_quantities, "var_2")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           // Get pointers to output quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           var_1_op{get_op(output_quantities, "var_1")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           var_2_op{get_op(output_quantities, "var_2")}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     static string_vector get_inputs();</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     static string_vector get_outputs();</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     static std::string get_name() { return "testmod"; }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    private:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // References to input quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; var_1;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; var_2;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Pointers to output quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double* var_1_op;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double* var_2_op;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Main operation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     void do_operation() const;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> };</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> string_vector testmod::get_inputs()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "var_1",          // Put var_1 units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "var_2"           // Put var_2 units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     };</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> string_vector testmod::get_outputs()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "var_1",          // Put var_1 units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "var_2"           // Put var_2 units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     };</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> void testmod::do_operation() const</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Make calculations here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Use `update` to set outputs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     update(var_1_op, 0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     update(var_2_op, 0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }  // namespace testlib</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #endif</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 3: A module with pairwise names</span></span></span>
<span class="r-in"><span><span class="co"># Here we use an outer product to generate pairwise combinations of</span></span></span>
<span class="r-in"><span><span class="co"># tissues and pool types</span></span></span>
<span class="r-in"><span><span class="va">tissues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'leaf'</span>, <span class="st">'stem'</span>, <span class="st">'root'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pools</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'carbon'</span>, <span class="st">'nitrogen'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">tissues</span>, <span class="va">pools</span>, <span class="va">paste</span>, sep <span class="op">=</span> <span class="st">'_'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">module_write</span><span class="op">(</span><span class="st">'testmod'</span>, <span class="st">'testlib'</span>, <span class="st">'differential'</span>, <span class="va">xs</span>, <span class="va">xs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #ifndef TESTLIB_TESTMOD_H</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #define TESTLIB_TESTMOD_H</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #include "../framework/module.h"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #include "../framework/state_map.h"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> namespace testlib</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> /**</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  * @class testmod</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  * @brief Put documentation here.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  */</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class testmod : public differential_module</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    public:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     testmod(</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         state_map const&amp; input_quantities,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         state_map* output_quantities)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         : differential_module{},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           // Get references to input quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           leaf_carbon{get_input(input_quantities, "leaf_carbon")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           stem_carbon{get_input(input_quantities, "stem_carbon")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           root_carbon{get_input(input_quantities, "root_carbon")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           leaf_nitrogen{get_input(input_quantities, "leaf_nitrogen")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           stem_nitrogen{get_input(input_quantities, "stem_nitrogen")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           root_nitrogen{get_input(input_quantities, "root_nitrogen")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           // Get pointers to output quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           leaf_carbon_op{get_op(output_quantities, "leaf_carbon")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           stem_carbon_op{get_op(output_quantities, "stem_carbon")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           root_carbon_op{get_op(output_quantities, "root_carbon")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           leaf_nitrogen_op{get_op(output_quantities, "leaf_nitrogen")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           stem_nitrogen_op{get_op(output_quantities, "stem_nitrogen")},</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           root_nitrogen_op{get_op(output_quantities, "root_nitrogen")}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     static string_vector get_inputs();</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     static string_vector get_outputs();</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     static std::string get_name() { return "testmod"; }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    private:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // References to input quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; leaf_carbon;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; stem_carbon;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; root_carbon;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; leaf_nitrogen;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; stem_nitrogen;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double const&amp; root_nitrogen;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Pointers to output quantities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double* leaf_carbon_op;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double* stem_carbon_op;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double* root_carbon_op;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double* leaf_nitrogen_op;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double* stem_nitrogen_op;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     double* root_nitrogen_op;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Main operation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     void do_operation() const;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> };</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> string_vector testmod::get_inputs()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "leaf_carbon",          // Put leaf_carbon units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "stem_carbon",          // Put stem_carbon units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "root_carbon",          // Put root_carbon units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "leaf_nitrogen",          // Put leaf_nitrogen units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "stem_nitrogen",          // Put stem_nitrogen units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "root_nitrogen"           // Put root_nitrogen units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     };</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> string_vector testmod::get_outputs()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "leaf_carbon",          // Put leaf_carbon units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "stem_carbon",          // Put stem_carbon units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "root_carbon",          // Put root_carbon units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "leaf_nitrogen",          // Put leaf_nitrogen units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "stem_nitrogen",          // Put stem_nitrogen units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "root_nitrogen"           // Put root_nitrogen units here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     };</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> void testmod::do_operation() const</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Make calculations here</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // Use `update` to set outputs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     update(leaf_carbon_op, 0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     update(stem_carbon_op, 0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     update(root_carbon_op, 0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     update(leaf_nitrogen_op, 0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     update(stem_nitrogen_op, 0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     update(root_nitrogen_op, 0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }  // namespace testlib</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #endif</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 4: Circular modules</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">module_write</span><span class="op">(</span>inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span> ,<span class="st">'x'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Will compile, but will cause a "circular quantities" error if it is used</span></span></span>
<span class="r-in"><span>  <span class="co"># in a BioCro simulation:</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">module_write</span><span class="op">(</span><span class="st">'inconsistent'</span>, <span class="st">'examplelib'</span>, type<span class="op">=</span><span class="st">'direct'</span>,</span></span>
<span class="r-in"><span>          inputs <span class="op">=</span> <span class="st">'x'</span>, outputs <span class="op">=</span> <span class="st">'x'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Justin M. McGrath, Edward B. Lochocki, Yufeng He, Scott W. Oswald, Scott Rohde, Deepak Jaiswal, Megan L. Matthews, Fernando E. Miguez, Stephen P. Long.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

