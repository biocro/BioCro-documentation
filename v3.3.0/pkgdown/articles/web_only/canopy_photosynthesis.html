<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Canopy Photosynthesis Models • BioCro</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Canopy Photosynthesis Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">BioCro</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../about_pkgdown_documentation.html">About</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>GENERAL BIOCRO USAGE</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../../articles/BioCro.html">Getting Started with BioCro (HTML)</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/workshop_I.pdf">Workshop I (PDF)</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/a_practical_guide_to_biocro.pdf">A Practical Guide to BioCro (PDF)</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/a_practical_guide_to_biocro.R">    [R code]</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/quantitative_model_comparison.pdf">Quantitative Comparison Between Two Photosynthesis Models (PDF)</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/quantitative_model_comparison.R">    [R code]</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/BioCro-II_Paper--Section-1.1-example.html">BioCro II Paper: Section 1.1 Example (HTML)</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/dynamical_systems.pdf">BioCro as a Dynamical System</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/an_introduction_to_biocro.pdf">An Introduction to BioCro for Those Who Want to Add Models (PDF)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>CROP GROWTH MODELING TOPICS</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../../articles/web_only/thick_layer_absorption.html">Light Absorption by a Thick Layer (HTML)</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/ball_berry_model.html">Using the Ball-Berry Model (HTML)</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/canopy_photosynthesis.html">Multi-layer Canopy Photosynthesis Models (HTML)</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/energy_balance.html">Energy Balance, Leaf Temperature, and Transpiration (HTML)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../../bookdown/index.html">Developer's Manual</a></li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-c-library" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">C++ Library</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-c-library">
<li><a class="dropdown-item" href="../../../doxygen/doxygen_docs_complete/index.html">Complete Doxygen Documentation</a></li>
    <li><a class="dropdown-item" href="../../../doxygen/doxygen_docs_framework/index.html">Framework Documentation</a></li>
    <li><a class="dropdown-item" href="../../../doxygen/doxygen_docs_modules/index.html">BioCro Module Documentation</a></li>
    <li><a class="dropdown-item" href="../../../doxygen/doxygen_docs_modules_public_members_only/index.html">BioCro Module Documentation (public members only)</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/biocro/biocro/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Canopy Photosynthesis Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biocro/biocro/blob/v3.3.0/vignettes/web_only/canopy_photosynthesis.Rmd" class="external-link"><code>vignettes/web_only/canopy_photosynthesis.Rmd</code></a></small>
      <div class="d-none name"><code>canopy_photosynthesis.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="general">
<span class="header-section-number">1</span> A General Canopy Photosynthesis Model<a class="anchor" aria-label="anchor" href="#general"></a>
</h2>
<p>At the leaf level, the net CO<span class="math inline">\(_2\)</span> assimilation rate per unit leaf area
(<span class="math inline">\(A_{n,leaf}\)</span>) depends on the incident photosynthetically active photon flux
density (PPFD; <span class="math inline">\(Q_{in}\)</span>), the absorbed shortwave energy (<span class="math inline">\(I_{abs}\)</span>), the ambient
CO<span class="math inline">\(_2\)</span> concentration outside the boundary layer (<span class="math inline">\(C_a\)</span>), the air temperature
(<span class="math inline">\(T_a\)</span>), the relative humidity (<span class="math inline">\(h_a\)</span>), and several other environmental factors.
Mathematically, we can express this by writing <span class="math inline">\(A_n\)</span> as a function of these
variables: <span class="math inline">\(A_{n,leaf} = A_{n,leaf}(Q_{in}, I_{abs}, C_a, T_a, h_a)\)</span>. The exact
equation used to calculate <span class="math inline">\(A_{n,leaf}\)</span> will generally depend on individual
choices for modelling photosynthetic biochemistry, stomatal response, and energy
balance. For simplicity, we do not attempt to reproduce them here.</p>
<p>Each of these environmental variables may change throughout a crop canopy. A
common way to treat this is to express each of them as a function of the
cumulative leaf area index (cLAI; <span class="math inline">\(\ell\)</span>). At the top of the canopy, <span class="math inline">\(\ell = 0\)</span>,
and it increases to <span class="math inline">\(\ell = L\)</span> at the bottom of the canopy, where <span class="math inline">\(L\)</span> is the
whole-canopy leaf area index (LAI). LAI itself is defined as the one-sided leaf
area per unit ground area. It can be loosely interpreted as the number of leaf
layers covering the ground. cLAI can then be interpreted as the LAI of leaves
above a certain point in the canopy.</p>
<p>For a wide area of a crop that has achieved canopy closure, lateral position
within the field is not expected to influence environmental conditions, leaving
depth within the canopy as the main variable. Cumulative LAI is a way to express
depth within the canopy using leaf area, since the amount of leaf area above a
particular point is more important for determining <span class="math inline">\(Q_{in}\)</span> (and the other
variables) than the physical distance below the canopy top.</p>
<p>With this in mind, we can write <span class="math inline">\(A_{n,leaf} = A_{n,leaf}(Q_{in}(\ell),
I_{abs}(\ell), C_a(\ell), T_a(\ell), h_a(\ell))\)</span>. This notation is a bit
unweildy, and it can be made more compact by writing <span class="math inline">\(A_{n,leaf} =
A_{n,leaf}(\ell)\)</span>. In this form, it is implied that each of the inputs to the
photosynthesis model used to calculate <span class="math inline">\(A_{n,leaf}\)</span> change with <span class="math inline">\(\ell\)</span>. This
notation is convenient because it allows us to define the net CO<span class="math inline">\(_2\)</span>
assimilation rate per unit ground area (<span class="math inline">\(A_{n,canopy}\)</span>) using a one-dimensional
integral over <span class="math inline">\(\ell\)</span>:</p>
<p><span class="math display" id="eq:AnCanopy">\[\begin{equation}
    A_{n,canopy} = \int_{\ell = 0}^{L} A_{n,leaf}(\ell) d \ell,
    \tag{1.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(A_{n,leaf}(\ell)\)</span> is the net CO<span class="math inline">\(_2\)</span> assimilation rate (per leaf area) of
an infinitesimally small piece of leaf located at a height within the canopy
where the cLAI is <span class="math inline">\(\ell\)</span>, and <span class="math inline">\(d \ell\)</span> is the change in cLAI associated with
that piece. (<span class="math inline">\(d \ell\)</span> can be thought of as <span class="math inline">\(L \cdot dS / S\)</span>, where <span class="math inline">\(dS\)</span> is the
area of the piece of leaf and <span class="math inline">\(S\)</span> is the total leaf area of the canopy.)</p>
<p>Equation <a href="#eq:AnCanopy">(1.1)</a> is the most general way to express the relationship
between leaf-level and canopy photosynthesis. From a biological point of view,
it is equivalent to dividing the canopy into infinitely many layers, each of
which is infinitesimally thin and contains an infinitesimally small amount of
leaf area, and then adding the contribution of each thin layer together to get
the whole canopy rate. The function <span class="math inline">\(A_{n,leaf}(\ell)\)</span> represents the rate from
such an infinitesimally thin leaf layer.</p>
<div class="section level3" number="1.1">
<h3 id="examples">
<span class="header-section-number">1.1</span> Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>A canopy photosynthesis model is discussed in <span class="citation">John H. M. Thornley and Johnson (<a href="#ref-thornley_plant_1990">1990</a>)</span> (see the
section <a href="#thornley">below</a>). Although Thornley uses different notation and a
simplistic model for photosynthesis, it is clear that his Equations 10.4a and
10.1b can be combined to express canopy photosynthesis (<span class="math inline">\(P\)</span>) in a similar way to
our Equation <a href="#eq:AnCanopy">(1.1)</a>:</p>
<p><span class="math display">\[\begin{equation}
    P = \int_0^L P_1(l) dl.
\end{equation}\]</span></p>
<p>Other examples can be found in journal articles, such as Equation 10 from
<span class="citation">Hirose and Werger (<a href="#ref-hirose_maximizing_1987">1987</a>)</span>. When a simple model of photosynthesis is used,
sometimes <span class="math inline">\(A_{n,leaf}(\ell)\)</span> is explicitly written, as in Table I from
<span class="citation">J. Goudriaan (<a href="#ref-goudriaan_simple_1986">1986</a>)</span>.</p>
</div>
</div>
<div class="section level2" number="2">
<h2 id="a-model-with-shaded-and-sunlit-leaves">
<span class="header-section-number">2</span> A Model with Shaded and Sunlit Leaves<a class="anchor" aria-label="anchor" href="#a-model-with-shaded-and-sunlit-leaves"></a>
</h2>
<p>Equation <a href="#eq:AnCanopy">(1.1)</a> is an oversimplified way to represent <span class="math inline">\(A_{n,canopy}\)</span>
because it ignores several other key variables that influence <span class="math inline">\(A_{n,leaf}\)</span>
besides <span class="math inline">\(\ell\)</span>. A common refinement of this model is to separately consider
sunlit and shaded leaves. A major difference between these two leaf classes is
the dependence of <span class="math inline">\(Q_{in}\)</span> on <span class="math inline">\(\ell\)</span>. Sunlit leaves at any depth within the
canopy all receive a very similar value of <span class="math inline">\(Q_{in}\)</span>, while shaded leaves
generally receive less light deeper within the canopy. When sunlit and shaded
leaves are treated separately, we can write</p>
<p><span class="math display">\[\begin{equation}
    A_{n,leaf}(\ell) = A_{n,leaf}^{sunlit}(\ell) \cdot f_{sunlit}(\ell) +
        A_{n,leaf}^{shaded}(\ell) \cdot f_{shaded}(\ell),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(A_{n,leaf}^{sunlit}(\ell)\)</span> and <span class="math inline">\(A_{n,leaf}^{shaded}(\ell)\)</span> are the
leaf-level net CO<span class="math inline">\(_2\)</span> assimilation rates per leaf area for sunlit and shaded
leaves at cLAI <span class="math inline">\(\ell\)</span>, and <span class="math inline">\(f_{sunlit}(\ell)\)</span> and <span class="math inline">\(f_{shaded}(\ell)\)</span> are the
fractions of sunlit and shaded leaf area at <span class="math inline">\(\ell\)</span>. (All leaves must be either
sunlit or shaded, so <span class="math inline">\(f_{sunlit}(\ell) + f_{shaded}(\ell) = 1\)</span>.) With this new
expression for leaf-level photosynthesis, Equation <a href="#eq:AnCanopy">(1.1)</a> can be
modified to</p>
<p><span class="math display" id="eq:AnCanopyRefined">\[\begin{equation}
    A_{n,canopy} = \int_{\ell = 0}^{L} \left[
        A_{n,leaf}^{sunlit}(\ell)f_{sunlit}(\ell) +
            A_{n,leaf}^{shaded}(\ell)f_{shaded}(\ell) \right] d \ell.
    \tag{2.1}
\end{equation}\]</span></p>
<div class="section level3" number="2.1">
<h3 id="examples-1">
<span class="header-section-number">2.1</span> Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a>
</h3>
<p>See, for example, Equation 18 from <span class="citation">Sellers (<a href="#ref-sellers_canopy_1985">1985</a>)</span> or Equation 7 from
<span class="citation">J. H. M. Thornley (<a href="#ref-thornley_instantaneous_2002">2002</a>)</span>.</p>
</div>
</div>
<div class="section level2" number="3">
<h2 id="a-multilayer-canopy-model">
<span class="header-section-number">3</span> A Multilayer Canopy Model<a class="anchor" aria-label="anchor" href="#a-multilayer-canopy-model"></a>
</h2>
<p>While Equations <a href="#eq:AnCanopy">(1.1)</a> and <a href="#eq:AnCanopyRefined">(2.1)</a> are useful for
defining <span class="math inline">\(A_{n,canopy}\)</span>, they have limited practical value since they do not
have analytical solutions for detailed mechanistic models of leaf-level
photosynthesis. As <a href="#thornley">Thornley suggests</a>, a numerical integration
approach must be used to calculate canopy assimilation in this case. The
simplest approach to numerical integration is to approximate the integral by a
<a href="https://en.wikipedia.org/wiki/Riemann_sum" class="external-link">Riemann sum</a>.</p>
<p>By dividing the cLAI interval <span class="math inline">\((0,L)\)</span> into <span class="math inline">\(N\)</span> subintervals of equal size and
converting the integral to a Riemann sum, Equation <a href="#eq:AnCanopyRefined">(2.1)</a>
becomes</p>
<p><span class="math display" id="eq:AnCanopyMultilayer">\[\begin{equation}
    A_{n,canopy} = \sum_{i = 0}^{N-1} \left[
        A_{n,leaf}^{sunlit}(\ell_i)f_{sunlit}(\ell_i) +
            A_{n,leaf}^{shaded}(\ell_i)f_{shaded}(\ell_i) \right]
                \cdot \frac{L}{N},
    \tag{3.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\ell_i = (i + 0.5) \cdot L / N\)</span> and <span class="math inline">\(L / N\)</span> is the cLAI subinterval
width. Here we have used the
<a href="https://en.wikipedia.org/wiki/Riemann_sum#Riemann_summation_methods" class="external-link">“midpoint rule”</a>
for the Riemann sum, but in principle the “left rule” or “right rule” could also
be used.</p>
<p>From a biological perspective, this approach to numerical integration can be
understood as dividing the crop canopy into <span class="math inline">\(N\)</span> thick layers of equal amounts of
leaf area. (Note that these layers are conceptually different than the
infinitesimally thin layers discussed in connection with Equation
<a href="#eq:AnCanopy">(1.1)</a>.) Thus, Equation <a href="#eq:AnCanopyMultilayer">(3.1)</a> is usually
referred to as a “multilayer canopy model.” In this model, we assume that
<span class="math inline">\(A_{n,leaf}^{sunlit}\)</span> for all sunlit leaves in a thick layer can be reasonably
approximated by <span class="math inline">\(A_{n,leaf}^{sunlit}\)</span> calculated for an infinitely thin layer
at the midpoint of that thick layer, and likewise for shaded leaves.</p>
<p>The accuracy of the multilayer canopy model expressed in Equation
<a href="#eq:AnCanopyMultilayer">(3.1)</a> will depend on how reasonable this assumption is.
Generally, the model will be more accurate when larger <span class="math inline">\(N\)</span> is used. As <span class="math inline">\(N\)</span>
becomes larger, the width of each thick layer becomes smaller, and so
environmental conditions across each thick layer become more uniform. Of course,
if <span class="math inline">\(N \rightarrow \infty\)</span>, the Riemann sum in Equation
<a href="#eq:AnCanopyMultilayer">(3.1)</a> converges back to the integral in Equation
<a href="#eq:AnCanopyRefined">(2.1)</a>.</p>
<div class="section level3" number="3.1">
<h3 id="examples-2">
<span class="header-section-number">3.1</span> Examples<a class="anchor" aria-label="anchor" href="#examples-2"></a>
</h3>
<p>Examples of multilayer canopy models can be found in the literature;
<span class="citation">Bonan et al. (<a href="#ref-bonan_moving_2021">2021</a>)</span> contains references to many of them. Despite their
prevalence, descriptions of these models rarely contain an explicit equation
describing exactly how to relate canopy-level assimilation to leaf-level
assimilation, as we have done with Equation <a href="#eq:AnCanopyMultilayer">(3.1)</a>.</p>
<p>For example, instead of providing an equation, <span class="citation">Pury and Farquhar (<a href="#ref-pury_simple_1997">1997</a>)</span> write “Canopy
photosynthesis rate was calculated by the summation of the product of rate of
leaf photosynthesis per unit leaf area by the leaf area in each class” (page
541).</p>
</div>
<div class="section level3" number="3.2">
<h3 id="non-multilayer-canopy-models">
<span class="header-section-number">3.2</span> Non-Multilayer Canopy Models<a class="anchor" aria-label="anchor" href="#non-multilayer-canopy-models"></a>
</h3>
<p>Note that if a different numerical integration technique such as Gaussian
quadrature is used instead of a Riemann sum, the canopy might not be divided
into layers; such a model would not be considered a multilayer canopy model
because it would not be conceptually divided into distinct thick layers
<span class="citation">(<a href="#ref-goudriaan_simple_1986">J. Goudriaan 1986</a>; <a href="#ref-goudriaan_light_2016">Jan Goudriaan 2016</a>)</span>.</p>
</div>
</div>
<div class="section level2" number="4">
<h2 id="biocros-multilayer-canopy-model">
<span class="header-section-number">4</span> BioCro’s Multilayer Canopy Model<a class="anchor" aria-label="anchor" href="#biocros-multilayer-canopy-model"></a>
</h2>
<p>In BioCro, we use the multilayer canopy model described in Chapter 15 of
<span class="citation">Campbell and Norman (<a href="#ref-campbell_introduction_1998">1998</a>)</span>. Example 15.2 in that book is especially useful
for demonstrating how the model’s equations should be used. However, note that
the example does not take a multilayer approach; instead, it only considers
sunlit and shaded leaves. Thus, some aspects of the example do not directly
apply for BioCro. For example, it is not necessary to calculate a weighted
average of diffuse PAR across the canopy in BioCro’s model.</p>
<p>Here we summarize the main parts of the model as they are used in BioCro.</p>
<div class="section level3" number="4.1">
<h3 id="sunlit-and-shaded-fractions">
<span class="header-section-number">4.1</span> Sunlit and Shaded Fractions<a class="anchor" aria-label="anchor" href="#sunlit-and-shaded-fractions"></a>
</h3>
<p>Equation 15.22 of <span class="citation">Campbell and Norman (<a href="#ref-campbell_introduction_1998">1998</a>)</span> calculates the fraction of sunlit
leaves:</p>
<p><span class="math display">\[\begin{equation}
    f_{sunlit}(\ell) = e^{-K_{direct} \cdot \ell},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(K_{direct}\)</span> is the canopy extinction coefficient for direct radiation.
The shaded fraction is then given by <span class="math inline">\(f_{shaded}(\ell) = 1 - f_{sunlit}\)</span>. The
extinction coefficient <span class="math inline">\(K_{direct}\)</span> depends on the leaf angle distribution and
the direction of incoming beam radiation (and hence the solar zenith angle). See
Equation 15.4 for more details.</p>
</div>
<div class="section level3" number="4.2">
<h3 id="incident-light">
<span class="header-section-number">4.2</span> Incident Light<a class="anchor" aria-label="anchor" href="#incident-light"></a>
</h3>
<p>Within a canopy, several distinct types of light can be considered:</p>
<ul>
<li><p>The beam flux just above the canopy <span class="math inline">\(Q_{ob}\)</span></p></li>
<li><p>The diffuse flux just above the canopy <span class="math inline">\(Q_{od}\)</span></p></li>
<li><p>The diffuse flux within the canopy <span class="math inline">\(Q_d\)</span></p></li>
<li><p>The down-scattered flux within the canopy <span class="math inline">\(Q_{sc}\)</span></p></li>
<li><p>The total beam flux (unintercepted beam and downscattered beam) within the
canopy <span class="math inline">\(Q_{bt}\)</span></p></li>
<li><p>The unintercepted beam flux within the canopy <span class="math inline">\(Q_b\)</span></p></li>
</ul>
<p>In general, there are broad distinctions between location (just above the canopy
or within the canopy), type (beam flux or diffuse flux), and source (flux from
the sky or flux that has been scattered by leaves in the canopy). Beam flux is
typically expressed as flux density through a horizontal plane, while diffuse
flux densities apply to any surface orientation because they are not
directional. Some of these fluxes are related to each other. In particular,
<span class="math inline">\(Q_{bt} = Q_{sc} + Q_b\)</span> (Equation 15.20).</p>
<p>Shaded leaves receive diffuse radiation and down-scattered radiation. Sunlit
leaves receive these types of radiation with the addition of direct beam
radiation. Expressed on a leaf area basis, the flux density incident on sunlit
and shaded leaves (<span class="math inline">\(Q_{in}^{sunlit}\)</span> and <span class="math inline">\(Q_{in}^{shaded}\)</span>) are</p>
<p><span class="math display">\[\begin{equation}
    Q_{in}^{sunlit} = K_{direct} \cdot Q_{ob} + Q_d + Q_{sc}
\end{equation}\]</span></p>
<p>and</p>
<p><span class="math display">\[\begin{equation}
    Q_{in}^{shaded} = Q_d + Q_{sc}
\end{equation}\]</span></p>
<p>(Equations 15.18 and 15.19). The term <span class="math inline">\(K_{direct} \cdot Q_{ob}\)</span> is the average
direct beam radiation accounting for the distribution of leaf angles.</p>
<p>Solar diffuse radiation originates in the sky due to atmospheric scattering of
the sun’s light and changes within the canopy according to</p>
<p><span class="math display">\[\begin{equation}
    Q_d(\ell) = Q_{od} \cdot e^{- \sqrt{\alpha} \cdot K_{diffuse} \cdot \ell},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> absorptivity of the leaves in the canopy and <span class="math inline">\(K_{diffuse}\)</span> is the
extinction coefficient for diffuse radiation (see Figure 15.4 and surrounding
discussion). The factor <span class="math inline">\(\sqrt{\alpha}\)</span> models the effect of light scattering
and transmission by the leaves. This is Equation 15.17.</p>
<p>Additional diffuse radiation is caused by scattering and transmission of the
direct beam by the leaves. It can be calculated as the difference between the
total beam radiation and unintercepted beam radiation as follows:</p>
<p><span class="math display">\[\begin{equation}
    Q_{sc}(\ell) = Q_{bt}(\ell) - Q_b(\ell)
\end{equation}\]</span></p>
<p>where</p>
<p><span class="math display">\[\begin{equation}
    Q_{bt}(\ell) = Q_{ob} \cdot e^{- \sqrt{\alpha} \cdot K_{direct} \cdot \ell}
\end{equation}\]</span></p>
<p>and</p>
<p><span class="math display">\[\begin{equation}
    Q_b(\ell) = Q_{ob} \cdot e^{- K_{direct} \cdot \ell}.
\end{equation}\]</span></p>
<p>These are Equations 15.20, 15.15, and 15.16.</p>
</div>
<div class="section level3" number="4.3">
<h3 id="absorbed-shortwave-energy">
<span class="header-section-number">4.3</span> Absorbed Shortwave Energy<a class="anchor" aria-label="anchor" href="#absorbed-shortwave-energy"></a>
</h3>
<p>Each leaf receives light spanning a wide range of wavelengths. Most light energy
is found in the photosynthetically active radiation (PAR) and near-infrared
(NIR) bands (400 - 700 nm and 700 - 2500 nm, respectively).</p>
<p>The incident light energy in the PAR band can be estimated from the incident
PPFD by assuming a value for the average energy per PAR photon:</p>
<p><span class="math display">\[\begin{equation}
    I_{in}^{PAR} = Q_{in} \cdot E
\end{equation}\]</span></p>
<p>where <span class="math inline">\(E\)</span> is the average energy per PAR photon. Then the absorbed PAR energy can
be found using the equation for absorption by a thin layer, which simply
multiplies the incident radiation by the absorptivity:</p>
<p><span class="math display">\[\begin{equation}
    I_{abs}^{PAR} = \alpha_{PAR} \cdot I_{in}^{PAR}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\alpha_{PAR} = 1 - T_{PAR} - R_{PAR}\)</span> is the PAR absorptivity, and
<span class="math inline">\(T_{PAR}\)</span> and <span class="math inline">\(R_{PAR}\)</span> are the leaf transmittance and reflectance in the PAR
band, respectively.</p>
<p>In direct sunlight, the amount of energy in the NIR band can be estimated from
<span class="math inline">\(I^{PAR}\)</span> using a known fraction <span class="math inline">\(f_{PAR}\)</span>:</p>
<p><span class="math display" id="eq:NIRfromPAR">\[\begin{equation}
    I^{NIR} = I^{PAR} \cdot (1 - f_{PAR}) / f_{PAR} \tag{4.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(f_{PAR}\)</span> is the fraction of shortwave energy in the PAR band. PAR and NIR
light are reflected and transmitted differently by leaves in the canopy, so this
fraction changes throughout the canopy. Rather than trying to predict
<span class="math inline">\(f_{PAR}(\ell)\)</span>, we simply calculate <span class="math inline">\(I_{in}^{NIR}\)</span> just above the canopy top
using Equation <a href="#eq:NIRfromPAR">(4.1)</a>, and then use the canopy light transmission
functions described above to calculate <span class="math inline">\(I_{in}^{NIR}(\ell)\)</span>. Then, at each point
in the canopy, the total absorbed shortwave energy can be calculated as</p>
<p><span class="math display">\[\begin{equation}
    I_{abs}^{shortwave} = \alpha_{PAR} \cdot I_{in}^{PAR} +
        \alpha_{NIR} \cdot I_{in}^{NIR}
\end{equation}\]</span></p>
</div>
</div>
<div class="section level2" number="5">
<h2 id="biocro-examples">
<span class="header-section-number">5</span> BioCro Examples<a class="anchor" aria-label="anchor" href="#biocro-examples"></a>
</h2>
<p>BioCro’s ten layer canopy properties module can be used to calculate and plot
several of the variables discussed above. We use a solar zenith angle of 40
degrees, total canopy LAI of 3, total incident PPFD of 2000 (with 80 percent in
the beam) to match example 15.2 from the textbook. Other parameter values come
from Soybean-BioCro.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/biocro/biocro" class="external-link">BioCro</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set inputs</span></span>
<span><span class="va">zenith_angle</span>  <span class="op">&lt;-</span> <span class="fl">40</span>   <span class="co"># degrees</span></span>
<span><span class="va">LAI</span>           <span class="op">&lt;-</span> <span class="fl">3</span>    <span class="co"># dimensionless</span></span>
<span><span class="va">total_ppfd</span>    <span class="op">&lt;-</span> <span class="fl">2000</span> <span class="co"># micromol / m^2 / s</span></span>
<span><span class="va">beam_fraction</span> <span class="op">&lt;-</span> <span class="fl">0.8</span>  <span class="co"># dimensionless</span></span>
<span><span class="va">windspeed</span>     <span class="op">&lt;-</span> <span class="fl">2.0</span>  <span class="co"># m / s</span></span>
<span></span>
<span><span class="co"># Calculate total PAR energy just above the canopy</span></span>
<span><span class="va">total_par</span> <span class="op">&lt;-</span> <span class="va">total_ppfd</span> <span class="op">*</span> <span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">par_energy_content</span></span>
<span></span>
<span><span class="co"># Run the ten-layer canopy properties module</span></span>
<span><span class="va">canopy_properties</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modules.html">evaluate_module</a></span><span class="op">(</span></span>
<span>    <span class="st">'BioCro:ten_layer_canopy_properties'</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span>, <span class="op">{</span></span>
<span>        <span class="va">cosine_zenith_angle</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">zenith_angle</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span></span>
<span>        <span class="va">lai</span> <span class="op">=</span> <span class="va">LAI</span></span>
<span>        <span class="va">par_incident_diffuse</span> <span class="op">=</span> <span class="va">total_par</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">beam_fraction</span><span class="op">)</span></span>
<span>        <span class="va">par_incident_direct</span> <span class="op">=</span> <span class="va">total_par</span> <span class="op">*</span> <span class="va">beam_fraction</span></span>
<span>        <span class="va">windspeed</span> <span class="op">=</span> <span class="va">windspeed</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a helping function for extracting subsets of the results</span></span>
<span><span class="va">canopy_profile</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">basename</span>, <span class="va">reslist</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">basename</span>, <span class="st">'_layer_[0-9]'</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">reslist</span><span class="op">)</span>,</span>
<span>        value <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">reslist</span><span class="op">[</span><span class="va">vnames</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Set the layer numbers</span></span>
<span><span class="va">nlayer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span></span></code></pre></div>
<p>First we can plot the fractions of sunlit and shaded leaves.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot sunlit and shaded fractions</span></span>
<span><span class="va">f_sunlit</span> <span class="op">&lt;-</span> <span class="fu">canopy_profile</span><span class="op">(</span><span class="st">'sunlit_fraction'</span>, <span class="va">canopy_properties</span><span class="op">)</span></span>
<span><span class="va">f_shaded</span> <span class="op">&lt;-</span> <span class="fu">canopy_profile</span><span class="op">(</span><span class="st">'shaded_fraction'</span>, <span class="va">canopy_properties</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">f_sunlit</span> <span class="op">+</span> <span class="va">f_shaded</span> <span class="op">~</span> <span class="va">nlayer</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Fraction of leaves'</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="canopy_photosynthesis_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;"></p>
<p>Now we can plot incident PPFD for leaves within the canopy. Here <code>Q_above</code> is
the total incident PPFD just above the top of the canopy.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot incident light levels</span></span>
<span><span class="va">Q_sunlit</span> <span class="op">&lt;-</span> <span class="fu">canopy_profile</span><span class="op">(</span><span class="st">'sunlit_incident_ppfd'</span>, <span class="va">canopy_properties</span><span class="op">)</span></span>
<span><span class="va">Q_shaded</span> <span class="op">&lt;-</span> <span class="fu">canopy_profile</span><span class="op">(</span><span class="st">'shaded_incident_ppfd'</span>, <span class="va">canopy_properties</span><span class="op">)</span></span>
<span><span class="va">Q_above</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep_len</a></span><span class="op">(</span><span class="va">total_ppfd</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">nlayer</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Q_sunlit</span> <span class="op">+</span> <span class="va">Q_shaded</span> <span class="op">+</span> <span class="va">Q_above</span> <span class="op">~</span> <span class="va">nlayer</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Incident PPFD (micromol / m^2 / s)'</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2100</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="canopy_photosynthesis_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;"></p>
<p>We can also plot absorbed shortwave energy for leaves within the canopy.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot absorbed shortwave energy</span></span>
<span><span class="va">I_abs_sunlit</span> <span class="op">&lt;-</span> <span class="fu">canopy_profile</span><span class="op">(</span><span class="st">'sunlit_absorbed_shortwave'</span>, <span class="va">canopy_properties</span><span class="op">)</span></span>
<span><span class="va">I_abs_shaded</span> <span class="op">&lt;-</span> <span class="fu">canopy_profile</span><span class="op">(</span><span class="st">'shaded_absorbed_shortwave'</span>, <span class="va">canopy_properties</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">I_abs_sunlit</span> <span class="op">+</span> <span class="va">I_abs_shaded</span> <span class="op">~</span> <span class="va">nlayer</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Absorbed shortwave energy (J / m^2 / s)'</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="canopy_photosynthesis_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;"></p>
<p>We can also plot the fraction of absorbed shortwave energy in the PAR band
through the canopy.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate absorptivity in the PAR band</span></span>
<span><span class="va">absorptivity_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span>, <span class="op">{</span><span class="fl">1</span> <span class="op">-</span> <span class="va">leaf_transmittance_par</span> <span class="op">-</span> <span class="va">leaf_reflectance_par</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate absorbed PAR energy</span></span>
<span><span class="va">par_abs_sunlit</span> <span class="op">&lt;-</span> <span class="va">Q_sunlit</span> <span class="op">*</span> <span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">par_energy_content</span> <span class="op">*</span> <span class="va">absorptivity_par</span></span>
<span><span class="va">par_abs_shaded</span> <span class="op">&lt;-</span> <span class="va">Q_shaded</span> <span class="op">*</span> <span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">par_energy_content</span> <span class="op">*</span> <span class="va">absorptivity_par</span></span>
<span></span>
<span><span class="co"># Calculate the fraction of absorbed energy in the PAR band</span></span>
<span><span class="va">sunlit_par_fraction</span> <span class="op">&lt;-</span> <span class="va">par_abs_sunlit</span> <span class="op">/</span> <span class="va">I_abs_sunlit</span></span>
<span><span class="va">shaded_par_fraction</span> <span class="op">&lt;-</span> <span class="va">par_abs_shaded</span> <span class="op">/</span> <span class="va">I_abs_shaded</span></span>
<span></span>
<span><span class="co"># Plot the fractions</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">sunlit_par_fraction</span> <span class="op">+</span> <span class="va">shaded_par_fraction</span> <span class="op">~</span> <span class="va">nlayer</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Fraction of absorbed light energy from PAR photons'</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="canopy_photosynthesis_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;"></p>
<p>Here we can see that although about half of solar light energy lies in the PAR
band, sunlit leaves absorb more PAR energy than NIR energy. Deeper within the
canopy, the fraction of absorbed light energy from PAR photons decreases.
Shaded leaves deep within the canopy may absorb more NIR than PAR energy.</p>
<p>As light levels vary within the canopy, leaf-level assimilation rates will also
vary. Here we can show this dependence by simulating light response curves at
a few different temperatures.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate an A-Q curve</span></span>
<span><span class="va">aq_curve</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modules.html">module_response_curve</a></span><span class="op">(</span></span>
<span>    <span class="st">'BioCro:c3_assimilation'</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span>, <span class="op">{</span></span>
<span>        <span class="va">StomataWS</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>        <span class="va">gbw</span> <span class="op">=</span> <span class="fl">1.2</span></span>
<span>        <span class="va">rh</span> <span class="op">=</span> <span class="fl">0.6</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>            Tleaf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">40</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>            Qabs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">total_ppfd</span> <span class="op">*</span> <span class="va">absorptivity_par</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="op">{</span><span class="va">temp</span> <span class="op">=</span> <span class="va">Tleaf</span><span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Include incident Q</span></span>
<span><span class="va">aq_curve</span><span class="op">$</span><span class="va">Qin</span> <span class="op">&lt;-</span> <span class="va">aq_curve</span><span class="op">$</span><span class="va">Qabs</span> <span class="op">/</span> <span class="va">absorptivity_par</span></span>
<span></span>
<span><span class="co"># Plot it</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Assim</span> <span class="op">~</span> <span class="va">Qin</span>,</span>
<span>    group <span class="op">=</span> <span class="va">Tleaf</span>,</span>
<span>    data <span class="op">=</span> <span class="va">aq_curve</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Qin (micromol / m^2 / s)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Leaf-level CO2 assimilation rate (micromol / m^2 / s)'</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="canopy_photosynthesis_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;"></p>
<p>Finally, we can see how assimilation rates change throughout the canopy. Here
we will use an air temperature of 25 degrees C.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get boundary layer conductance</span></span>
<span><span class="va">gbw_canopy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modules.html">evaluate_module</a></span><span class="op">(</span></span>
<span>    <span class="st">'BioCro:canopy_gbw_thornley'</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        canopy_height <span class="op">=</span> <span class="va">LAI</span> <span class="op">/</span> <span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">heightf</span>,</span>
<span>        windspeed <span class="op">=</span> <span class="va">windspeed</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">gbw_canopy</span></span>
<span></span>
<span><span class="co"># Get absorbed longwave energy</span></span>
<span><span class="va">air_temperature</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span></span>
<span><span class="va">absorbed_longwave</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modules.html">evaluate_module</a></span><span class="op">(</span></span>
<span>    <span class="st">'BioCro:stefan_boltzmann_longwave'</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">air_temperature</span>, emissivity_sky <span class="op">=</span> <span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">emissivity_sky</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">absorbed_longwave</span></span>
<span></span>
<span><span class="co"># Calculate canopy assimilation rates</span></span>
<span><span class="va">canopy_assimilation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modules.html">evaluate_module</a></span><span class="op">(</span></span>
<span>    <span class="st">'BioCro:ten_layer_c3_canopy'</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span>, <span class="va">canopy_properties</span><span class="op">)</span>, <span class="op">{</span></span>
<span>        <span class="va">StomataWS</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>        <span class="va">rh</span> <span class="op">=</span> <span class="fl">0.6</span></span>
<span>        <span class="va">temp</span> <span class="op">=</span> <span class="va">air_temperature</span></span>
<span>        <span class="va">gbw_canopy</span> <span class="op">=</span> <span class="va">gbw_canopy</span></span>
<span>        <span class="va">absorbed_longwave</span> <span class="op">=</span> <span class="va">absorbed_longwave</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot canopy assimilation rates</span></span>
<span><span class="va">Assim_sunlit</span> <span class="op">&lt;-</span> <span class="fu">canopy_profile</span><span class="op">(</span><span class="st">'sunlit_Assim'</span>, <span class="va">canopy_assimilation</span><span class="op">)</span></span>
<span><span class="va">Assim_shaded</span> <span class="op">&lt;-</span> <span class="fu">canopy_profile</span><span class="op">(</span><span class="st">'shaded_Assim'</span>, <span class="va">canopy_assimilation</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Assim_sunlit</span> <span class="op">+</span> <span class="va">Assim_shaded</span> <span class="op">~</span> <span class="va">nlayer</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Net CO2 assimilation rate (micromol / m^2 / s)'</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="canopy_photosynthesis_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;"></p>
<p>The canopy assimilation module also calculates other outputs such as leaf
temperature.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot canopy leaf temperatures</span></span>
<span><span class="va">Tleaf_sunlit</span> <span class="op">&lt;-</span> <span class="fu">canopy_profile</span><span class="op">(</span><span class="st">'sunlit_leaf_temperature'</span>, <span class="va">canopy_assimilation</span><span class="op">)</span></span>
<span><span class="va">Tleaf_shaded</span> <span class="op">&lt;-</span> <span class="fu">canopy_profile</span><span class="op">(</span><span class="st">'shaded_leaf_temperature'</span>, <span class="va">canopy_assimilation</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Tleaf_sunlit</span> <span class="op">+</span> <span class="va">Tleaf_shaded</span> <span class="op">~</span> <span class="va">nlayer</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Leaf temperature (degrees C)'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="canopy_photosynthesis_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;"></p>
<p>We can also see the total canopy assimilation rate (in units of
micromol / m^2 / s):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">canopy_totals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modules.html">evaluate_module</a></span><span class="op">(</span></span>
<span>    <span class="st">'BioCro:ten_layer_canopy_integrator'</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">canopy_properties</span>, <span class="va">canopy_assimilation</span><span class="op">)</span>, <span class="op">{</span></span>
<span>        <span class="va">growth_respiration_fraction</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>        <span class="va">lai</span> <span class="op">=</span> <span class="va">LAI</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">canopy_totals</span><span class="op">$</span><span class="va">canopy_assimilation_molar_flux</span></span>
<span><span class="co">#&gt; [1] 35.28481</span></span></code></pre></div>
<p>Another potentially interesting output is the total PPFD absorbed by the canopy.
We can check to make sure this is smaller than the incident PPFD just above the
canopy. This is not calculated by BioCro, so we will have to calculate it here.
We can define the total PPFD absorbed by the canopy to be</p>
<p><span class="math display">\[\begin{equation}
    Q_{abs,canopy} = \int_{\ell = 0}^{L} \left[
        Q_{abs,sunlit}(\ell) \cdot f_{sunlit}(\ell) +
            Q_{abs,shaded}(\ell) \cdot f_{shaded}(\ell) \right] d \ell.
\end{equation}\]</span></p>
<p>Taking a numeric approximation of the integral and using <span class="math inline">\(Q_{abs} = \alpha
\cdot Q_{in}\)</span>, we can write the multilayer canopy version:</p>
<p><span class="math display">\[\begin{equation}
    Q_{abs,canopy} = \alpha \cdot \frac{L}{N} \cdot \sum_{i = 0}^{N - 1} \left[
        Q_{in,sunlit}(\ell_i) \cdot f_{sunlit}(\ell_i) +
            Q_{in,shaded}(\ell_i) \cdot f_{shaded}(\ell_i) \right]
\end{equation}\]</span></p>
<p>This can be done in R as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Q_abs_canopy</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">absorptivity_par</span> <span class="op">*</span> <span class="op">(</span><span class="va">LAI</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span> <span class="op">*</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Q_sunlit</span> <span class="op">*</span> <span class="va">f_sunlit</span> <span class="op">+</span> <span class="va">Q_shaded</span> <span class="op">*</span> <span class="va">f_shaded</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Q_abs_canopy</span></span>
<span><span class="co">#&gt; [1] 1407.459</span></span>
<span></span>
<span><span class="va">Q_abs_canopy</span> <span class="op">/</span> <span class="va">total_ppfd</span></span>
<span><span class="co">#&gt; [1] 0.7037294</span></span></code></pre></div>
</div>
<div class="section level2" number="6">
<h2 id="thornley">
<span class="header-section-number">6</span> Selected Passages from Thornley (1990)<a class="anchor" aria-label="anchor" href="#thornley"></a>
</h2>
<p>Here we reproduce a few sections and equations from <span class="citation">John H. M. Thornley and Johnson (<a href="#ref-thornley_plant_1990">1990</a>)</span> because
this book is not available in electronic form.</p>
<p>Section 10.1.1 (<em>Light interception and attenuation</em>):</p>
<blockquote>
<p>The light attenuation through canopies is described by Beer’s law, as
discussed in Chapter 8. For monocultures this is (eqn (8.1a))</p>
<p><span class="math inline">\(\qquad I(l) = I_0 e^{-kl}\)</span>, <span class="math inline">\(\qquad\)</span> (10.1a)</p>
<p>where <span class="math inline">\(I_0\)</span> and <span class="math inline">\(I(l)\)</span> W (m<span class="math inline">\(^2\)</span> ground)<span class="math inline">\(^{-1}\)</span> of photosynthetically active
radiation (PAR) are the irradiances per unit horizontal area above and within
the canopy respectively at cumulative leaf area index <span class="math inline">\(l\)</span> and <span class="math inline">\(k\)</span> is the
extinction coefficient. The irradiance incident on the surface of a leaf
within the canopy at depth <span class="math inline">\(l\)</span> is</p>
<p><span class="math inline">\(\qquad I_1(l) = \frac{k}{1 - m}I(l)\)</span> W (m<span class="math inline">\(^2\)</span> leaf)<span class="math inline">\(^{-1}\)</span>, <span class="math inline">\(\qquad\)</span> (10.1b)</p>
<p>where <span class="math inline">\(m\)</span> is the leaf transmission coefficient.</p>
</blockquote>
<p>Section 10.1.2 (<em>Single-leaf photosynthesis</em>):</p>
<blockquote>
<p>Throughout the analysis, the term photosynthesis is taken to be single-leaf
gross photosynthesis minus photorespiration and is defined by eqn (9.10i):</p>
<p><span class="math inline">\(\qquad P_1(I_1) = \frac{1}{2 \theta} \left\{ \alpha I_1 + P_m - \left[(\alpha I_1 + P_m)^2 - 4 \theta \alpha I_1 P_m \right]^{1/2} \right\}\)</span>, <span class="math inline">\(\qquad\)</span> (10.2a)</p>
<p>with units kg CO<span class="math inline">\(_2\)</span> (m<span class="math inline">\(^2\)</span> leaf)<span class="math inline">\(^{-1}\)</span> s<span class="math inline">\(^{-1}\)</span>. <span class="math inline">\(\alpha\)</span> is the
photochemical efficiency, with units kg CO<span class="math inline">\(_2\)</span> J<span class="math inline">\(^{-1}\)</span>, <span class="math inline">\(P_m\)</span> is the
asymptotic value of <span class="math inline">\(P_1\)</span> at saturating irradiance, and <span class="math inline">\(\theta\)</span> is a
dimensionless parameter (<span class="math inline">\(0 \leq \theta \leq 1\)</span>). (Note that the notation used
here is slightly different to that used in Chapter 9 in that the subscript 1
is used to denote single leaf photosynthesis.)</p>
</blockquote>
<p>Section 10.2.1 (<em>Instantaneous canopy photosynthesis</em>):</p>
<blockquote>
<p>The instantaneous rate of canopy photosynthesis is, in general, given by</p>
<p><span class="math inline">\(\qquad P = \int_0^L P_1(I_1) dl\)</span>, <span class="math inline">\(\qquad\)</span> (10.4a)</p>
<p>with units kg CO<span class="math inline">\(_2\)</span> (m<span class="math inline">\(^2\)</span> ground)<span class="math inline">\(^{-1}\)</span> s<span class="math inline">\(^{-1}\)</span>, where <span class="math inline">\(l\)</span> is the
cumulative leaf area index and <span class="math inline">\(L\)</span> is the total leaf area index.</p>
</blockquote>
<p>Section 10.5 (<em>Discussion</em>):</p>
<blockquote>
<p>There will, of course, be situations where the level of approximation at the
leaf photosynthesis level, or the description of light interception, is
oversimplified. For example, we have not included the possibility of diurnal
variation in the stomatal conductance (in response to factors such as leaf
water potential or carbohydrate content) which may affect the rate of leaf
photosynthesis. In such cases it will be necessary [to] use the general
concepts developed here and evaluate the integrals - either through the depth
of the canopy or throughout the day - numerically.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bonan_moving_2021" class="csl-entry">
Bonan, Gordon B., Edward G. Patton, John J. Finnigan, Dennis D. Baldocchi, and Ian N. Harman. 2021. <span>“Moving Beyond the Incorrect but Useful Paradigm: Reevaluating Big-Leaf and Multilayer Plant Canopies to Model Biosphere-Atmosphere Fluxes – a Review.”</span> <em>Agricultural and Forest Meteorology</em> 306 (August): 108435. <a href="https://doi.org/10.1016/j.agrformet.2021.108435" class="external-link">https://doi.org/10.1016/j.agrformet.2021.108435</a>.
</div>
<div id="ref-campbell_introduction_1998" class="csl-entry">
Campbell, Gaylon S., and John Norman. 1998. <em>An <span>Introduction</span> to <span>Environmental</span> <span>Biophysics</span></em>. 2nd ed. New York: Springer-Verlag. <a href="https://www.springer.com/gp/book/9780387949376" class="external-link">https://www.springer.com/gp/book/9780387949376</a>.
</div>
<div id="ref-goudriaan_simple_1986" class="csl-entry">
Goudriaan, J. 1986. <span>“A Simple and Fast Numerical Method for the Computation of Daily Totals of Crop Photosynthesis.”</span> <em>Agricultural and Forest Meteorology</em> 38 (1): 249–54. <a href="https://doi.org/10.1016/0168-1923(86)90063-8" class="external-link">https://doi.org/10.1016/0168-1923(86)90063-8</a>.
</div>
<div id="ref-goudriaan_light_2016" class="csl-entry">
Goudriaan, Jan. 2016. <span>“Light <span>Distribution</span>.”</span> In <em>Canopy <span>Photosynthesis</span>: <span>From</span> <span>Basics</span> to <span>Applications</span></em>, edited by Kouki Hikosaka, Ülo Niinemets, and Niels P. R. Anten, 3–22. Dordrecht: Springer Netherlands. <a href="https://doi.org/10.1007/978-94-017-7291-4_1" class="external-link">https://doi.org/10.1007/978-94-017-7291-4_1</a>.
</div>
<div id="ref-hirose_maximizing_1987" class="csl-entry">
Hirose, T., and M. J. A. Werger. 1987. <span>“Maximizing Daily Canopy Photosynthesis with Respect to the Leaf Nitrogen Allocation Pattern in the Canopy.”</span> <em>Oecologia</em> 72 (4): 520–26. <a href="https://doi.org/10.1007/BF00378977" class="external-link">https://doi.org/10.1007/BF00378977</a>.
</div>
<div id="ref-pury_simple_1997" class="csl-entry">
Pury, D. G. G. De, and G. D. Farquhar. 1997. <span>“Simple Scaling of Photosynthesis from Leaves to Canopies Without the Errors of Big-Leaf Models.”</span> <em>Plant, Cell &amp; Environment</em> 20 (5): 537–57. <a href="https://doi.org/10.1111/j.1365-3040.1997.00094.x" class="external-link">https://doi.org/10.1111/j.1365-3040.1997.00094.x</a>.
</div>
<div id="ref-sellers_canopy_1985" class="csl-entry">
Sellers, P. J. 1985. <span>“Canopy Reflectance, Photosynthesis and Transpiration.”</span> <em>International Journal of Remote Sensing</em> 6 (8): 1335–72. <a href="https://doi.org/10.1080/01431168508948283" class="external-link">https://doi.org/10.1080/01431168508948283</a>.
</div>
<div id="ref-thornley_instantaneous_2002" class="csl-entry">
Thornley, J. H. M. 2002. <span>“Instantaneous <span>Canopy</span> <span>Photosynthesis</span>: <span>Analytical</span> <span>Expressions</span> for <span>Sun</span> and <span>Shade</span> <span>Leaves</span> <span>Based</span> on <span>Exponential</span> <span>Light</span> <span>Decay</span> <span>Down</span> the <span>Canopy</span> and an <span>Acclimated</span> <span>Non</span>‐rectangular <span>Hyperbola</span> for <span>Leaf</span> <span>Photosynthesis</span>.”</span> <em>Annals of Botany</em> 89 (4): 451–58. <a href="https://doi.org/10.1093/aob/mcf071" class="external-link">https://doi.org/10.1093/aob/mcf071</a>.
</div>
<div id="ref-thornley_plant_1990" class="csl-entry">
Thornley, John H. M., and I. R. Johnson. 1990. <em>Plant and <span>Crop</span> <span>Modelling</span>: <span>A</span> <span>Mathematical</span> <span>Approach</span> to <span>Plant</span> and <span>Crop</span> <span>Physiology</span></em>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Justin M. McGrath, Edward B. Lochocki, Yufeng He, Scott W. Oswald, Scott Rohde, Deepak Jaiswal, Megan L. Matthews, Fernando E. Miguez, Stephen P. Long.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
